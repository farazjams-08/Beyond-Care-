<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BeyondCare — Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
</head>

<body>

  <div class="bg-orb"></div>

  <!-- Brand -->
  <div class="brand">
    <div class="logo">BC</div>
    <span>BeyondCare</span>
  </div>

  <!-- Navigation -->
  <nav class="top-nav">
    <a href="/home" class="active">Home</a>
    <a href="/bmi">BMI</a>
    <a href="/symptoms">Symptoms</a>
    <a href="/chatbot">Chatbot</a>
    <a id="logout" href="#" class="logout">Logout</a>
  </nav>

  <!-- Main container -->
  <div class="container" style="margin-top:100px;">
    <h2>Your Health Dashboard</h2>
    <p class="subtitle">Quickly navigate to BMI Insights, Symptoms Analysis, or talk to the AI assistant.</p>

    <!-- Dashboard cards -->
    <div class="dash-grid">
      <a href="/bmi" class="dash-card">
        <h3>BMI Analysis</h3>
        <p>Calculate BMI & get AI-generated diet + exercise plans.</p>
      </a>

      <a href="/symptoms" class="dash-card">
        <h3>Symptom Checker</h3>
        <p>Enter symptoms to receive possible conditions & suggestions.</p>
      </a>

      <a href="/chatbot" class="dash-card">
        <h3>AI Chatbot</h3>
        <p>Ask anything related to health and wellness.</p>
      </a>
    </div>

    <!-- History Section -->
    <h3 style="margin-top:40px;margin-bottom:10px;">Recent Activity</h3>
    <div id="historyArea" class="history-section"></div>
  </div>

  <div class="page-foot">© BeyondCare • Hackathon Edition</div>

  <!-- JS -->
  <script>
    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("token");
      window.location.href = "/";
    });

    // Load history
    async function loadHistory() {
      const token = localStorage.getItem("token");
      if (!token) return window.location.href = "/";

      const res = await fetch("/api/history", {
        headers: { "Authorization": "Bearer " + token }
      });

      const data = await res.json();
      const area = document.getElementById("historyArea");

      if (!data.history || data.history.length === 0) {
        area.innerHTML = "<p class='subtitle'>No activity yet.</p>";
        return;
      }

      area.innerHTML = "";

      data.history.forEach((h, i) => {
        area.innerHTML += `
          <div class="history-card smooth-card" onclick="toggleHistory(${i})">
            <div class="history-head">
              <div>
                <span class="history-type">${h.type.toUpperCase()}</span>
                <span class="history-date">${new Date(h.createdAt).toLocaleString()}</span>
              </div>
              <span class="history-arrow" id="arrow-${i}">▼</span>
            </div>

            <div class="history-content" id="content-${i}">
              <p><b>Input:</b> ${h.input || "-"}</p>
              <pre>${h.response || "-"}</pre>
            </div>
          </div>
        `;
      });
    }

    function toggleHistory(idx) {
      const content = document.getElementById("content-" + idx);
      const arrow = document.getElementById("arrow-" + idx);

      content.classList.toggle("open");
      arrow.classList.toggle("rotated");
    }

    loadHistory();
  </script>

  <!-- Smooth Animations -->
  <style>
    .smooth-card {
      padding:16px;
      border-radius:12px;
      margin-bottom:12px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      cursor:pointer;
      transition:0.25s;
      animation:fadeIn 0.3s ease;
    }

    .smooth-card:hover {
      background:rgba(255,255,255,.12);
      transform:translateY(-2px);
    }

    .history-head {
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .history-type {
      font-weight:700;
      color:var(--accent);
      margin-right:10px;
    }

    .history-date {
      font-size:12px;
      opacity:.7;
    }

    .history-arrow {
      transition:0.3s;
      font-size:14px;
      opacity:.8;
    }

    .history-arrow.rotated {
      transform:rotate(180deg);
    }

    .history-content {
      margin-top:12px;
      display:none;
      opacity:0;
      transition:0.25s ease;
    }

    .history-content.open {
      display:block;
      opacity:1;
    }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(5px); }
      to   { opacity:1; transform:translateY(0); }
    }
  </style>

</body>
</html>
